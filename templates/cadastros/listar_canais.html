{% extends 'base.html' %}
{% load static %}
{% load humanize %}

{% load static %}

{% block title %}Listagem de Canais de Comercialização | EXTENSÃO Amazônia{% endblock %}

{% block content %}
<section class="content-header">
  <div class="container-fluid">
    <h1><i class="fas fa-store text-success"></i> Canais de Comercialização</h1>
    <p class="text-muted">Canais mapeados, rotas e estrutura logística identificada.</p>
  </div>
</section>

<section class="content">
  <div class="container-fluid">
    <div class="row">
      {% for canal in canais %}
  <div class="card mb-4 shadow-sm">
    <div class="card-header bg-teal text-white">
      Rota: <strong>{{ canal.rota_nome }}</strong>
    </div>
    <div class="card-body">
      <p><strong>Comunidade:</strong> {{ canal.comunidade }}</p>
      <p><strong>Entrevistado:</strong> {{ canal.nome_entrevistado }}</p>
      <p><strong>Data:</strong> {{ canal.data|date:"d/m/Y" }}</p>

      <h6 class="mt-3 text-teal"><i class="fas fa-map-marker-alt"></i> Itinerário da Rota:</h6>
      <ul class="list-group mb-2">
        {% for parada in canal.rota_itinerario %}
          <li class="list-group-item">
            <strong>Local:</strong> {{ parada.ponto }}<br>
            <strong>Tempo:</strong> {{ parada.tempo }}<br>
            <strong>Observação:</strong> {{ parada.observacao }}
          </li>
        {% empty %}
          <li class="list-group-item text-muted">Nenhuma parada informada.</li>
        {% endfor %}
      </ul>
    </div>
  </div>
{% endfor %}

    </div>

    <div class="card card-outline card-secondary">
  <div class="card-header">
    <h3 class="card-title"><i class="fas fa-table"></i> Tabela Detalhada</h3>
  </div>
  <div class="card-body table-responsive">
    <table class="table table-bordered table-sm table-striped align-middle">
      <thead class="thead-light text-center">
        <tr>
          <th>Data</th>
          <th>Comunidade</th>
          <th>Entrevistado</th>
          <th>Rota</th>
          <th>Transporte e Embalagem</th>
        </tr>
      </thead>
<tbody>
  {% for canal in canais %}
  <tr>
    <td class="text-center">{{ canal.data|date:"d/m/Y" }}</td>
    <td>{{ canal.comunidade }}</td>
    <td>{{ canal.nome_entrevistado }}</td>
    <td>{{ canal.rota_nome }}</td>
    <td>
      {% if canal.transporte_embalagem %}
        {% for t in canal.transporte_embalagem %}
          <div>
            <strong>{{ t.transporte|default:"–" }}</strong> /
            <span>{{ t.embalagem|default:"–" }}</span><br>
            <small class="text-muted">{{ t.observacao|default:"–" }}</small>
          </div>
          {% if not forloop.last %}
            <hr class="my-1" />
          {% endif %}
        {% endfor %}
      {% else %}
        <span class="text-muted">–</span>
      {% endif %}
    </td>
  </tr>
  {% endfor %}
</tbody>

    </table>
  </div>
</div>



  </div>
</section>
{% endblock %}