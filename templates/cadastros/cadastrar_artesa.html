{% extends 'base.html' %}
{% load static %}

{% block title %}Cadastro de Artes√£ | EXTENS√ÉO Amaz√¥nia{% endblock %}

{% block content %}
<section class="content-header">
  <div class="container-fluid">
    <h1><i class="fas fa-female text-purple"></i> Cadastro de Artes√£</h1>
    <p class="text-muted">Formul√°rio de levantamento t√©cnico e socioecon√¥mico de mulheres artes√£s.</p>
  </div>
</section>

<section class="content">
  <div class="container-fluid">

    <div id="status-conexao" class="alert text-center shadow" style="display: none;"></div>

    <!-- ALERTA DE ERRO DE C√ÇMERA -->
<div id="alerta-camera" class="alert alert-danger alert-dismissible fade show shadow text-center position-relative" role="alert" style="display:none; max-width: 600px; margin: 20px auto;">
  <button type="button"
          class="btn btn-sm btn-light rounded-circle fw-bold"
          data-bs-dismiss="alert"
          aria-label="Fechar"
          style="position: absolute; top: -10px; right: -10px; z-index: 1050; line-height:1; padding: 0.25rem 0.55rem;">
    √ó
  </button>
  <strong>Erro:</strong>
  <div id="mensagem-erro-camera" class="mt-2"></div>
</div>


    <form method="post">
      {% csrf_token %}
      <div class="card card-outline card-purple shadow">
        <div class="card-header">
          <h3 class="card-title"><i class="fas fa-user-edit"></i> Informa√ß√µes Pessoais</h3>
        </div>
        <div class="card-body">

              <div class="form-group col-md-12">
  <label>üë§ Respons√°vel pelo levantamento</label>
  <input type="text" name="responsavel" class="form-control" 
         value="{{ request.user.get_full_name|default:request.user.username }}" readonly>
</div>

          <fieldset class="border p-3 mb-4">
            <legend class="w-auto text-purple"><i class="fas fa-id-card"></i> Dados B√°sicos</legend>

            <div class="form-group">
              <label>üë© Nome da Artes√£</label>
              <input type="text" name="nome" class="form-control" required>
            </div>

            
            <div class="form-row">
              <div class="form-group col-md-4">
                <label>üéÇ Idade</label>
                <input type="number" name="idade" class="form-control">
              </div>
              <div class="form-group col-md-8">
                <label>üéì Escolaridade</label>
                <select name="escolaridade" class="form-control">
                  <option>N√£o alfabetizada</option>
                  <option>Ensino Fundamental Incompleto</option>
                  <option>Fundamental Completo</option>
                  <option>M√©dio Incompleto</option>
                  <option>M√©dio Completo</option>
                  <option>Superior</option>
                </select>
              </div>
            </div>

            <div class="form-row">
              <div class="form-group col-md-6">
                <label>üë®‚Äçüë©‚Äçüëß Pessoas na casa</label>
                <input type="number" name="pessoas_na_casa" class="form-control">
              </div>
              <div class="form-group col-md-6">
                <label>üë• Familiares que ajudam</label>
                <input type="number" name="familiares_na_producao" class="form-control">
              </div>
            </div>

            <div class="form-group">
              <label>üí∞ Renda do artesanato</label>
              <select name="renda_artesanato" class="form-control">
                <option>A principal da casa</option>
                <option>Um complemento</option>
                <option>Apenas eventual</option>
              </select>
            </div>
          </fieldset>

          <fieldset class="border p-3 mb-4">
            <legend class="w-auto text-indigo"><i class="fas fa-hammer"></i> Produ√ß√£o e Vendas</legend>

            <div class="form-group">
              <label>üé® Tipo(s) de produ√ß√£o</label>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="tipos_producao[]" value="Cestaria de fibras naturais" id="producao1">
                <label class="form-check-label" for="producao1">Cestaria de fibras naturais</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="tipos_producao[]" value="Biojoias" id="producao2">
                <label class="form-check-label" for="producao2">Biojoias</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="tipos_producao[]" value="Bordados" id="producao3">
                <label class="form-check-label" for="producao3">Bordados</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="tipos_producao[]" value="Costura criativa" id="producao4">
                <label class="form-check-label" for="producao4">Costura criativa</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="tipos_producao[]" value="Croch√™/tric√¥" id="producao5">
                <label class="form-check-label" for="producao5">Croch√™/tric√¥</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="tipos_producao[]" value="Outros" id="producao6" onchange="toggleOutros(this)">
                <label class="form-check-label" for="producao6">Outros</label>
              </div>

              <div class="mt-2" id="outros_tipos_div" style="display: none;">
                <input type="text" name="outros_tipos" class="form-control" placeholder="Descreva o(s) outro(s) tipo(s)">
              </div>
            </div>


            <div class="form-group">
              <label>‚è±Ô∏è Tempo de experi√™ncia (anos)</label>
              <input type="text" name="tempo_artesanato" class="form-control">
            </div>
            <div class="form-group">
              <label>üìö Como aprendeu a atividade?</label>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="forma_aprendizado[]" value="Fam√≠lia/tradi√ß√£o local" id="aprendizado1">
                <label class="form-check-label" for="aprendizado1">Fam√≠lia/tradi√ß√£o local</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="forma_aprendizado[]" value="Curso ou capacita√ß√£o" id="aprendizado2">
                <label class="form-check-label" for="aprendizado2">Curso ou capacita√ß√£o</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="forma_aprendizado[]" value="Sozinha (autodidata)" id="aprendizado3">
                <label class="form-check-label" for="aprendizado3">Sozinha (autodidata)</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="forma_aprendizado[]" value="Outro" id="aprendizado4" onchange="toggleOutroAprendizado(this)">
                <label class="form-check-label" for="aprendizado4">Outro</label>
              </div>

              <div class="mt-2" id="outro_aprendizado_div" style="display: none;">
                <input type="text" name="forma_aprendizado_outro" class="form-control" placeholder="Descreva como aprendeu">
              </div>
            </div>

            

            <div class="form-group">
              <label>‚≠ê Quais s√£o os principais pontos fortes do seu artesanato?</label>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="pontos_fortes[]" value="Qualidade do material" id="ponto1">
                <label class="form-check-label" for="ponto1">Qualidade do material</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="pontos_fortes[]" value="Criatividade/design" id="ponto2">
                <label class="form-check-label" for="ponto2">Criatividade/design</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="pontos_fortes[]" value="Tradi√ß√£o e identidade cultural" id="ponto3">
                <label class="form-check-label" for="ponto3">Tradi√ß√£o e identidade cultural</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="pontos_fortes[]" value="Boa aceita√ß√£o do p√∫blico" id="ponto4">
                <label class="form-check-label" for="ponto4">Boa aceita√ß√£o do p√∫blico</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="pontos_fortes[]" value="Outro" id="ponto5" onchange="toggleOutroPonto(this)">
                <label class="form-check-label" for="ponto5">Outro</label>
              </div>

              <div class="mt-2" id="outro_ponto_div" style="display: none;">
                <input type="text" name="pontos_fortes_outro" class="form-control" placeholder="Descreva outro ponto forte">
              </div>
            </div>

            

            <div class="form-group">
              <label>üõí Voc√™ j√° vendeu para:</label>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="formas_venda[]" value="Feira local" id="venda1">
                <label class="form-check-label" for="venda1">Feira local</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="formas_venda[]" value="Cliente direto (porta a porta/boca a boca)" id="venda2">
                <label class="form-check-label" for="venda2">Cliente direto (porta a porta/boca a boca)</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="formas_venda[]" value="Encomendas personalizadas" id="venda3">
                <label class="form-check-label" for="venda3">Encomendas personalizadas</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="formas_venda[]" value="Internet/redes sociais" id="venda4">
                <label class="form-check-label" for="venda4">Internet/redes sociais</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="formas_venda[]" value="Lojas/associa√ß√µes" id="venda5">
                <label class="form-check-label" for="venda5">Lojas/associa√ß√µes</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="formas_venda[]" value="Nunca vendeu" id="venda6">
                <label class="form-check-label" for="venda6">Nunca vendeu</label>
              </div>
            </div>

            <div class="form-check mb-2">
              <input type="checkbox" name="material_divulgacao" value="1" class="form-check-input" id="divulgacaoCheck">
              <label class="form-check-label" for="divulgacaoCheck">üì¢ Possui material de divulga√ß√£o?</label>
            </div>
            <div class="form-check">
              <input type="checkbox" name="interesse_feiras" value="1" class="form-check-input" id="feiraCheck">
              <label class="form-check-label" for="feiraCheck">üé™ Deseja participar de feiras?</label>
            </div>
          </fieldset>

          <fieldset class="border p-3 mb-4">
            <legend class="w-auto text-danger"><i class="fas fa-tools"></i> Desafios e Apoios</legend>

            <div class="form-group">
              <label>üîß Quais s√£o as maiores dificuldades para produzir o seu artesanato?</label>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="dificuldades_producao[]" value="Falta de mat√©ria-prima" id="dif1">
                <label class="form-check-label" for="dif1">Falta de mat√©ria-prima</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="dificuldades_producao[]" value="Falta de espa√ßo adequado para produ√ß√£o" id="dif2">
                <label class="form-check-label" for="dif2">Falta de espa√ßo adequado para produ√ß√£o</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="dificuldades_producao[]" value="Falta de tempo (cuidados com casa/fam√≠lia)" id="dif3">
                <label class="form-check-label" for="dif3">Falta de tempo (cuidados com casa/fam√≠lia)</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="dificuldades_producao[]" value="Baixo acesso √† capacita√ß√£o ou cursos" id="dif4">
                <label class="form-check-label" for="dif4">Baixo acesso √† capacita√ß√£o ou cursos</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="dificuldades_producao[]" value="Dificuldade com ferramentas/equipamentos" id="dif5">
                <label class="form-check-label" for="dif5">Dificuldade com ferramentas/equipamentos</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="dificuldades_producao[]" value="Outro" id="dif6" onchange="toggleOutroDificuldade(this)">
                <label class="form-check-label" for="dif6">Outro</label>
              </div>

              <div class="mt-2" id="outro_dificuldade_div" style="display: none;">
                <input type="text" name="dificuldades_producao_outro" class="form-control" placeholder="Descreva outra dificuldade">
              </div>
            </div>

            

            <div class="form-group">
              <label>üìâ Quais s√£o as maiores dificuldades para vender?</label>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="dificuldades_venda[]" value="Falta de pontos de venda" id="vendadif1">
                <label class="form-check-label" for="vendadif1">Falta de pontos de venda</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="dificuldades_venda[]" value="Falta de transporte" id="vendadif2">
                <label class="form-check-label" for="vendadif2">Falta de transporte</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="dificuldades_venda[]" value="Pouca visibilidade" id="vendadif3">
                <label class="form-check-label" for="vendadif3">Pouca visibilidade</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="dificuldades_venda[]" value="Falta de cliente" id="vendadif4">
                <label class="form-check-label" for="vendadif4">Falta de cliente</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="dificuldades_venda[]" value="Pre√ßo baixo pago pelo produto" id="vendadif5">
                <label class="form-check-label" for="vendadif5">Pre√ßo baixo pago pelo produto</label>
              </div>
            </div>

            <div class="form-group">
              <label>ü§ù Voc√™ j√° teve acesso a algum apoio p√∫blico ou privado como:</label>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoios_recebidos[]" value="Capacita√ß√£o" id="apoio1">
                <label class="form-check-label" for="apoio1">Capacita√ß√£o</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoios_recebidos[]" value="Microcr√©dito" id="apoio2">
                <label class="form-check-label" for="apoio2">Microcr√©dito</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoios_recebidos[]" value="Associa√ß√£o/cooperativa" id="apoio3">
                <label class="form-check-label" for="apoio3">Associa√ß√£o/cooperativa</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoios_recebidos[]" value="Apoio da prefeitura/secretaria" id="apoio4">
                <label class="form-check-label" for="apoio4">Apoio da prefeitura/secretaria</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoios_recebidos[]" value="Nenhum" id="apoio5">
                <label class="form-check-label" for="apoio5">Nenhum</label>
              </div>
            </div>

            <div class="form-group">
              <label>üõ†Ô∏è Que tipo de apoio ajudaria voc√™ a produzir melhor?</label>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoio_producao[]" value="Equipamentos (m√°quina de costura, tear, ferramentas)" id="apoioProd1">
                <label class="form-check-label" for="apoioProd1">Equipamentos (m√°quina de costura, tear, ferramentas)</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoio_producao[]" value="Mat√©ria-prima" id="apoioProd2">
                <label class="form-check-label" for="apoioProd2">Mat√©ria-prima</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoio_producao[]" value="Espa√ßo coletivo de produ√ß√£o" id="apoioProd3">
                <label class="form-check-label" for="apoioProd3">Espa√ßo coletivo de produ√ß√£o</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoio_producao[]" value="Forma√ß√£o t√©cnica (design, acabamento e etc.)" id="apoioProd4">
                <label class="form-check-label" for="apoioProd4">Forma√ß√£o t√©cnica (design, acabamento e etc.)</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoio_producao[]" value="Organiza√ß√£o de grupo ou associa√ß√£o" id="apoioProd5">
                <label class="form-check-label" for="apoioProd5">Organiza√ß√£o de grupo ou associa√ß√£o</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoio_producao[]" value="Outros" id="apoioProd6" onchange="toggleOutroApoioProducao(this)">
                <label class="form-check-label" for="apoioProd6">Outros</label>
              </div>

              <div class="mt-2" id="outro_apoio_producao_div" style="display: none;">
                <input type="text" name="apoio_producao_outros" class="form-control" placeholder="Descreva outro tipo de apoio">
              </div>
            </div>

            

            <div class="form-group">
              <label>üíº Que tipo de apoio ajudaria a melhorar suas vendas?</label>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoio_venda[]" value="Divulga√ß√£o dos produtos" id="apoioVenda1">
                <label class="form-check-label" for="apoioVenda1">Divulga√ß√£o dos produtos</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoio_venda[]" value="Loja comunit√°ria ou ponto fixo" id="apoioVenda2">
                <label class="form-check-label" for="apoioVenda2">Loja comunit√°ria ou ponto fixo</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoio_venda[]" value="Apoio com redes sociais" id="apoioVenda3">
                <label class="form-check-label" for="apoioVenda3">Apoio com redes sociais</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoio_venda[]" value="Participa√ß√£o em feiras" id="apoioVenda4">
                <label class="form-check-label" for="apoioVenda4">Participa√ß√£o em feiras</label>
              </div>

              <div class="form-check">
                <input class="form-check-input" type="checkbox" name="apoio_venda[]" value="Forma√ß√£o em precifica√ß√£o ou empreendedorismo" id="apoioVenda5">
                <label class="form-check-label" for="apoioVenda5">Forma√ß√£o em precifica√ß√£o ou empreendedorismo</label>
              </div>
            </div>


          </fieldset>

          <fieldset class="border p-3 mb-4">
            <legend class="w-auto text-muted"><i class="fas fa-comment-dots"></i> Fala da Artes√£</legend>
            <div class="form-group">
              <label>üó£Ô∏è Espa√ßo livre para a artes√£ se expressar</label>
              <textarea name="fala_artesa" class="form-control" rows="3" placeholder="Coment√°rios livres, sentimentos, sugest√µes..."></textarea>
            </div>
          </fieldset>

          <fieldset class="border p-3 mb-4">
  <legend class="w-auto text-primary"><i class="fas fa-camera"></i> Foto de Evid√™ncia</legend>

  <div class="form-group text-center">
    <video id="video" width="100%" height="240" autoplay class="border rounded mb-2"></video>
    <canvas id="canvas" style="display:none;"></canvas>
    <input type="hidden" name="foto_base64" id="foto_base64">
    
    <div class="btn-group mt-2" role="group">
      <button type="button" class="btn btn-outline-primary" onclick="capturarFoto()">
        <i class="fas fa-camera"></i> Tirar Foto
      </button>
      <button type="button" class="btn btn-outline-danger" onclick="desligarCamera()">
        <i class="fas fa-power-off"></i> Desligar C√¢mera
      </button>
      <button type="button" class="btn btn-outline-secondary" onclick="alternarCamera()">
        <i class="fas fa-sync-alt"></i> Alternar C√¢mera
      </button>
    </div>
  </div>

  <div id="preview" class="text-center mt-3" style="display:none;">
    <p class="text-success"><i class="fas fa-check-circle"></i> Foto capturada com sucesso!</p>
    <img id="foto_preview" src="#" alt="Pr√©via da Foto" class="img-thumbnail" style="max-width: 100%;">
  </div>
</fieldset>



        </div>

        <div class="card-footer d-flex justify-content-end">
          <button type="submit" class="btn btn-success">
            <i class="fas fa-save"></i> Salvar Cadastro
          </button>
        </div>
      </div>
    </form>
  </div>
</section>


<script>
  function toggleOutros(checkbox) {
    const outrosDiv = document.getElementById('outros_tipos_div');
    outrosDiv.style.display = checkbox.checked ? 'block' : 'none';
  }
</script>

<script>
  function toggleOutroAprendizado(checkbox) {
    const outroDiv = document.getElementById('outro_aprendizado_div');
    outroDiv.style.display = checkbox.checked ? 'block' : 'none';
  }
</script>

<script>
  function toggleOutroPonto(checkbox) {
    const outroDiv = document.getElementById('outro_ponto_div');
    outroDiv.style.display = checkbox.checked ? 'block' : 'none';
  }
</script>

<script>
  function toggleOutroDificuldade(checkbox) {
    const outroDiv = document.getElementById('outro_dificuldade_div');
    outroDiv.style.display = checkbox.checked ? 'block' : 'none';
  }
</script>

<script>
  function toggleOutroApoioProducao(checkbox) {
    const outroDiv = document.getElementById('outro_apoio_producao_div');
    outroDiv.style.display = checkbox.checked ? 'block' : 'none';
  }
</script>




<script>
  let stream = null;
  let usandoFrontal = true;

  async function iniciarCamera() {
    try {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
      }

      const constraints = {
        video: {
          facingMode: usandoFrontal ? "user" : "environment"
        },
        audio: false
      };

      stream = await navigator.mediaDevices.getUserMedia(constraints);
      document.getElementById('video').srcObject = stream;

    } catch (err) {
  exibirErroCamera("N√£o foi poss√≠vel acessar a c√¢mera. Verifique se o navegador tem permiss√£o e se est√° acessando por HTTPS.");
}

  }

  function desligarCamera() {
    if (stream) {
      stream.getTracks().forEach(track => track.stop());
      stream = null;
      document.getElementById('video').srcObject = null;
    }
  }

  function alternarCamera() {
    usandoFrontal = !usandoFrontal;
    iniciarCamera();
  }

  function capturarFoto() {
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const fotoBase64 = document.getElementById('foto_base64');
    const preview = document.getElementById('preview');
    const fotoPreview = document.getElementById('foto_preview');

    canvas.width = video.videoWidth;
    canvas.height = video.videoHeight;
    canvas.getContext('2d').drawImage(video, 0, 0, canvas.width, canvas.height);

    const imagemBase64 = canvas.toDataURL('image/png');
    fotoBase64.value = imagemBase64;
    fotoPreview.src = imagemBase64;
    preview.style.display = "block";
  }

  // Iniciar a c√¢mera automaticamente ao carregar a p√°gina
  document.addEventListener('DOMContentLoaded', iniciarCamera);
</script>

<script>
  // off line

  const form = document.querySelector("form");
  const STORAGE_KEY = "cadastros_artesa_offline";

  function isOffline() {
    return !navigator.onLine;
  }

  function salvarOffline() {
    const formData = new FormData(form);
    const dados = {};
    formData.forEach((value, key) => {
      if (key.endsWith("[]")) {
        const cleanKey = key.replace("[]", "");
        dados[cleanKey] = dados[cleanKey] || [];
        dados[cleanKey].push(value);
      } else {
        dados[key] = value;
      }
    });

    let registros = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    registros.push(dados);
    localStorage.setItem(STORAGE_KEY, JSON.stringify(registros));

    Swal.fire("‚úÖ Cadastro salvo localmente!", "Ser√° sincronizado ao voltar a rede.", "success");
  }

  function sincronizarCadastros() {
    const registros = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
    if (registros.length === 0) return;

    registros.forEach(dados => {
      fetch("/sincronizar/artesa/", {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value,
        },
        body: JSON.stringify(dados)
      })
      .then(response => {
        if (response.ok) {
          console.log("‚úÖ Sincronizado com sucesso");
        }
      });
    });

    localStorage.removeItem(STORAGE_KEY);
  }

  // Detectar envio do formul√°rio
  form.addEventListener("submit", function (e) {
    if (isOffline()) {
      e.preventDefault();
      salvarOffline();
    }
  });

  // Tentar sincronizar ao voltar online
  window.addEventListener("online", sincronizarCadastros);
</script>



<script>
  const statusDiv = document.getElementById("status-conexao");

  function atualizarStatusConexao() {
    if (navigator.onLine) {
      statusDiv.className = "alert alert-success text-center shadow";
      statusDiv.innerHTML = "‚úÖ Conectado ‚Äî cadastros ser√£o enviados normalmente.";
    } else {
      statusDiv.className = "alert alert-warning text-center shadow";
      statusDiv.innerHTML = "‚ö†Ô∏è Voc√™ est√° offline ‚Äî cadastros ser√£o salvos localmente.";
    }
    statusDiv.style.display = "block";
  }

  // Atualiza ao carregar e quando mudar
  window.addEventListener('load', atualizarStatusConexao);
  window.addEventListener('online', atualizarStatusConexao);
  window.addEventListener('offline', atualizarStatusConexao);
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
  
function exibirErroCamera(mensagem) {
  const alerta = document.getElementById("alerta-camera");
  const spanMensagem = document.getElementById("mensagem-erro-camera");

  spanMensagem.textContent = mensagem;

  alerta.classList.add("show");        // Garante visibilidade
  alerta.classList.remove("fade");     // Remove transi√ß√£o se ativa
  alerta.style.display = "block";      // Mostra o alerta

  // Oculta automaticamente ap√≥s 6 segundos
  setTimeout(() => {
    alerta.classList.remove("show");
    alerta.classList.add("fade");
    alerta.style.display = "none";
  }, 6000);
}

</script>


<script>
  // Verifica se o par√¢metro ?sucesso=1 est√° na URL
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get("sucesso") === "1") {
    Swal.fire({
      icon: "success",
      title: "Cadastro realizado!",
      text: "O cadastro foi salvo com sucesso.",
      confirmButtonColor: "#6f42c1" // roxo
    });

    // Remove o par√¢metro da URL (evita reaparecer ao recarregar)
    history.replaceState(null, "", window.location.pathname);
  }
</script>



{% endblock %}
