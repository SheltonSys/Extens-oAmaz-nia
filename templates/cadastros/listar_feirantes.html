{% extends 'base.html' %}
{% load static %}

{% block title %}Listagem de Feirantes | EXTENSÃO Amazônia{% endblock %}

{% block content %}

<style>
  @media (min-width: 992px) {
    .col-lg-2-4 {
      flex: 0 0 auto;
      width: 20%;
    }
  }

  .card-feirante {
    border: none;
    border-radius: 0.75rem;
    transition: all 0.3s ease-in-out;
  }

  .card-feirante:hover {
    transform: translateY(-3px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
  }

  .feirante-img {
    width: 70px;
    height: 70px;
    object-fit: cover;
  }

  .truncate-text {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: block;
  }
</style>

<section class="content-header">
  <div class="container-fluid">
    <h1><i class="fas fa-people-carry text-warning"></i> Feirantes</h1>
    <p class="text-muted">Cadastro e acompanhamento das feiras, produtos vendidos e impactos sociais.</p>
  </div>
</section>

<section class="content">
  <div class="container-fluid">
    <div class="row">
      {% for feirante in feirantes %}
      <div class="col-6 col-sm-4 col-md-3 col-lg-2-4 mb-4">
        <div class="card shadow-sm card-feirante h-100">
          <div class="bg-warning text-white text-center p-2 rounded-top">
            <h6 class="fw-bold mb-0">Feira: {{ feirante.nome_feira }}</h6>
            <small>{{ feirante.local }}</small>
          </div>
          <div class="text-center mt-2">
            <img src="{% if feirante.foto_evidencia %}{{ feirante.foto_evidencia.url }}{% else %}{% static 'assets/dist/img/logo_extenção.png' %}{% endif %}"
                 class="rounded-circle border feirante-img shadow-sm" alt="Foto">
          </div>
          <div class="card-body text-center py-2">
            <small class="d-block"><strong>Periodicidade:</strong> {{ feirante.periodicidade }}</small>
            <small class="d-block truncate-text" title="{{ feirante.produtos }}"><strong>Produtos:</strong> {{ feirante.produtos }}</small>
          </div>
          <div class="card-footer text-center py-1 bg-light">
            <small class="text-muted"><i class="fas fa-box"></i> Volume: {{ feirante.volume }}</small>
          </div>
        </div>
      </div>
      {% empty %}
      <div class="col-12">
        <div class="alert alert-info text-center">
          Nenhum feirante cadastrado até o momento.
        </div>
      </div>
      {% endfor %}
    </div>

    <div class="card card-outline card-secondary mt-4">
      <div class="card-header">
        <h3 class="card-title"><i class="fas fa-table"></i> Tabela Geral</h3>
      </div>
      <div class="card-body table-responsive">
        <table class="table table-bordered table-striped table-sm">
          <thead class="thead-light">
            <tr>
              <th>Nome da Feira</th>
              <th>Local</th>
              <th>Periodicidade</th>
              <th>Produtos</th>
              <th>Benefícios</th>
            </tr>
          </thead>
          <tbody>
            {% for f in feirantes %}
            <tr>
              <td>{{ f.nome_feira }}</td>
              <td>{{ f.local }}</td>
              <td>{{ f.periodicidade }}</td>
              <td>{{ f.produtos }}</td>
              <td>
                {% if f.beneficios_lista %}
                  <ul class="mb-0 ps-3">
                    {% for b in f.beneficios_lista %}
                      <li>{{ b }}</li>
                    {% endfor %}
                  </ul>
                {% else %}
                  <span class="text-muted">–</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

  </div>
</section>
{% endblock %}
